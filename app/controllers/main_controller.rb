class MainController < ApplicationController
  def index; end

  def create
    base_prompt = params[:base_prompt]

    if base_prompt.blank?
      @error_message = "å…¥åŠ›ã—ã¦ã‹ã‚‰ã€Œå¤‰æ›ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„"
      @output = nil
      render :index

    else
      style = params[:style]
      tone = params[:tone]
      emoji = params[:emoji]
      radio_emoji = params[:radio_emoji]

      case radio_emoji
      when "no_kaomoji"
        emoji_rule ="é¡”ç³»çµµæ–‡å­—ï¼ˆðŸ˜ŠðŸ˜‚ðŸ˜¢ãªã©ï¼‰ã¯ä¸€åˆ‡ä½¿ã‚ãªã„ã§ãã ã•ã„"
      when "no_icon"
        emoji_rule = "ã‚¢ã‚¤ã‚³ãƒ³ç³»çµµæ–‡å­—(â¤ï¸ ðŸ’” â­ ðŸ”¥ðŸ ðŸš—ðŸ“±ãªã©ï¼‰ã¯ä¸€åˆ‡ä½¿ã‚ãªã„ã§ãã ã•ã„ã€ãŸã ã—æ‰‹ã®ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ï¼ˆðŸ‘Œ ðŸ‘ ðŸ™Œ ðŸ™ãªã©ï¼‰ã¯ä½¿ã£ã¦ã‚ˆã„"
      when "nothing"
        emoji_rule = "çµµæ–‡å­—ã¯ä½•ã§ã‚‚ä½¿ã£ã¦ãã ã•ã„"
      else
        emoji_rule = ""
      end

      case tone
      when "formal"
        tone_rule = "ä¸å¯§ã§ã‹ã—ã“ã¾ã£ãŸè¡¨ç¾ã«ã—ã¦ãã ã•ã„ã€‚æ´¾æ‰‹ãªçµµæ–‡å­—ã¯ä½¿ã‚ãªã„ã§ãã ã•ã„ã€‚é–¢è¥¿å¼ã®å ´åˆã¯é–¢è¥¿å¼ã‚’ä½¿ã£ãŸä¸å¯§èªžã§è¡¨ç¾ã—ã¦ãã ã•ã„ã€‚ã€Œã€œã—ã¦ã¯ã‚Šã¾ã™ã‹ã€ã€Œã€œã•ã‚Œã¯ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€ã®ã‚ˆã†ã«æ•¬èªžã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚"
      when "casual"
        tone_rule = "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã§è¦ªã—ã¿ã‚„ã™ã„è¡¨ç¾ã«ã—ã¦ãã ã•ã„ã€‚çµµæ–‡å­—ã¯æ¥½ã—ããƒãƒ©ãƒ³ã‚¹ã‚ˆãä½¿ã£ã¦ãã ã•ã„ã€‚é–¢è¥¿å¼ã®å ´åˆã¯ã€Œã€œã—ã¦ã‚‹ã‚“ï¼Ÿã€ã€Œã€œã‚„ã­ã‚“ã€ã®ã‚ˆã†ãªå£èª¿ã«ã—ã¦ãã ã•ã„ã€‚"
      when "frank"
        tone_rule = "ç •ã‘ãŸçŽ‡ç›´ãªè¡¨ç¾ã«ã—ã¦ãã ã•ã„ã€‚çµµæ–‡å­—ã¯è‡ªç”±ã«ãŸãã•ã‚“ä½¿ã£ã¦æ§‹ã„ã¾ã›ã‚“ã€‚é–¢è¥¿å¼ã®å ´åˆã¯ã€Œã€œã‚„ã‚ã€ã€Œã€œã¡ã‚ƒã†ï¼Ÿã€ã®ã‚ˆã†ã«ãƒ©ãƒ•ãªè¨€ã„æ–¹ã«ã—ã¦ãã ã•ã„ã€‚"
      else
        tone_rule = ""
      end

      case emoji
      when "add_emoji"
        prompt = <<~PROMPT
          æ¬¡ã®ãƒ†ã‚­ã‚¹ãƒˆã«çµµæ–‡å­—ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼š
          ã€Œ#{base_prompt}ã€

          æ¡ä»¶:
          - æ–‡ç« ã®å†…å®¹ã¯å¤‰æ›´ã—ãªã„
          - çµµæ–‡å­—ã®é¸ã³æ–¹ã«ãƒˆãƒ¼ãƒ³ã€Œ#{tone_rule}ã€ã‚’åæ˜ ã™ã‚‹
          - #{emoji_rule}
        PROMPT
      when "kansai"
        prompt = <<~PROMPT
          æ¬¡ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’é–¢è¥¿å¼ã«ç¿»è¨³ã—ã¦ãã ã•ã„ï¼ˆç¿»è¨³ã®ã¿ã€èª¬æ˜Žãªã—ï¼‰ï¼š
          ã€Œ#{base_prompt}ã€

          æ¡ä»¶:
          - ãƒˆãƒ¼ãƒ³: #{tone_rule}
          - çµµæ–‡å­—ã¯ä½¿ã‚ãªã„
        PROMPT
      when "emoji_kansai"
        prompt = <<~PROMPT
          æ¬¡ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’é–¢è¥¿å¼ã«ç¿»è¨³ã—ã€çµµæ–‡å­—ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼ˆç¿»è¨³ã®ã¿ã€èª¬æ˜Žãªã—ï¼‰ï¼š

          æ¡ä»¶:
          - ãƒˆãƒ¼ãƒ³: #{tone_rule}ï¼ˆé–¢è¥¿å¼ã¨çµµæ–‡å­—ã§è¡¨ç¾ï¼‰
          - #{emoji_rule}
        PROMPT
      else
        prompt = "å¤‰æ›ã‚¿ã‚¤ãƒ—ãŒé¸æŠžã•ã‚Œã¦ã„ã¾ã›ã‚“"
      end
      result = OpenaiService.generate_text(prompt)
      # æ–‡é ­ã¨æ–‡æœ«ã«ã‚ã‚‹ã€Œã€ã‚’å‰Šé™¤
      # æ–‡é ­ãƒ»æ–‡æœ«ã«ã‚ã‚‹ã€Œã‚„ã€ãªã©ã®ä½™è¨ˆãªæ‹¬å¼§ã‚’å‰Šé™¤
      result = result.gsub(/\A[ã€Œ]+|[ã€]+$/, '')
      @input_text = base_prompt
      @output = result

      render :index
    end
  end
end
