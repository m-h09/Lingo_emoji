<%= form_with url: main_index_path, method: :post, data: { turbo: false }, html: { autocomplete: "off" } do %>

  <div class="container px-0">
    <div class="d-flex justify-content-center mb-3" style="max-width:500px; margin:0 auto; gap:8px;">

      <div style="flex: 0 0 30%;">
        <%= select_tag :emoji, options_for_select(
              Translation.emojis.keys.map {|key| [t("enums.translation.emoji.#{key}"), key] }, params[:emoji]
            ), class: "form-select" %>
      </div>

      <div style="flex: 0 0 30%;">
        <%= select_tag :tone, options_for_select(
              Translation.tones.keys.map {|key| [t("enums.translation.tone.#{key}"), key] }, params[:tone]
            ), class: "form-select" %>
      </div>

      <div style="flex: 0 0 30%;">
        <%= select_tag :strength, options_for_select(
              Translation.strengths.keys.map {|key| [t("enums.translation.strength.#{key}"), key] }, params[:strength]
            ), class: "form-select" %>
      </div>

    </div>
  </div>


  <!-- PCエリア -->
<div class="d-none d-md-block" style="max-width:800px; margin:0 auto;">
  <% output_text = @output.presence %>
  <!-- PC入力（textarea） -->
  <textarea name="base_prompt" class="form-control border border-dark mt-3 mb-4"
            rows="5" placeholder="入力してください"><%= @input_text %></textarea>

  <!-- ボタン行 -->
  <div class="row g-2 mb-4 justify-content-end">

    <div class="col-md-6 text-center">
      <%= submit_tag "変換",
          class: "btn btn-light border border-dark w-100 py-3 fs-5" %>
    </div>

    <div class="col-md-3 d-flex gap-2">
      <%= button_tag type: "submit", name: "retry",
          class: "btn btn-outline-secondary w-100 py-3 fs-6 text-nowrap" do %>
        <i class="bi bi-arrow-clockwise"></i> 再試行
      <% end %>

      <button type="button" id="clear-btn"
        class="btn btn-outline-secondary border border-dark w-100 py-3 fs-6 text-nowrap">
        クリア
      </button>
    </div>

  </div>

  <!-- 出力結果（青背景） -->
  <div class="px-4 py-3 rounded position-relative" style="background-color:#87cefa;">
    <h4 class="text-center fw-bold mb-3">出力結果</h4>

    <div id="txt" class="copy-wrapper bg-white p-4 border border-2 rounded shadow-sm position-relative" style="min-height:150px;">
      <% if @output_error.present? %>
        <p class="text-danger fw-bold"><%= @output_error %></p>
      <% else %>
        <div id="txt-body"><%= output_text %></div>
      <% end %>

      <!-- コピーアイコン -->
      <button class="btn btn-link position-absolute top-0 end-0 mt-2 me-2 p-0"
              type="button" aria-label="コピー"
              data-content="<%= output_text %>">
        <%= image_tag "copy_icon_128895.svg", style: "width:24px; height:24px;" %>
      </button>

    </div>
  </div>
</div>




<!-- スマホ入出力エリア-->
<!-- スマホ ラジオボタン-->
  <div class="d-block d-md-none mt-2 mb-4 mx-auto" style="max-width:500px;">
    <div id="emoji-radio-group" class=" mb-4 fs-6 d-flex justify-content-between">
      <% Translation.radio_emojis.keys.each do |key| %>

        <label class="d-flex align-items-center">
          <%= radio_button_tag :radio_emoji, key, params[:radio_emoji] == key %>
          <%= t("enums.translation.radio_emoji.#{key}") %>
        </label>
      <% end %>
    </div>
    <% if @input_error.present? %>
      <div class="text-start mb-1 fs-6">
        <p style="color:red; font-weight:bold;">【入力エラー】<%= @input_error %></p>
      </div>
  <% end %>
  </div>
  <!--スマホラジオラスト -->
<div class="mb-3 d-block d-md-none">
  <% output_text = @output.presence %>
<!-- 出力内容を決める-->
  <% output_text = @output.presence %>
  <!-- ▼ スマホ用 出力結果 -->
  <div class="d-block d-md-none px-4 py-3 container rounded position-relative mt-4"style="background-color:#87cefa;">
    <h4 class="text-center fw-bold mb-3">出力結果</h4>

    <div id="txt" class="copy-wrapper position-relative bg-white p-3 rounded" style="min-height:120px;">
      <% if @output_error.present? %>
        <p class="text-danger fw-bold"><%= @output_error %></p>
      <% else %>
        <div id="txt-body"><%= output_text %></div>
      <% end %>

      <!-- コピーアイコン（右上） -->
      <button class="copy-btn btn btn-link p-0 position-absolute top-0 end-0 mt-2 me-2"
              type="button" aria-label="コピー"
              data-content="<%= output_text %>">
        <%= image_tag "copy_icon_128895.svg", style: "width:20px; height:20px;" %>
      </button>

        <div class="copy-toast badge text-bg-dark position-absolute top-0 end-0 mt-2 me-5"
            style="display:none;">
          コピーしました
        </div>
      </div>
    </div>
  </div>
  <!---出力結果スマホ用ラスト -->


  <div class="d-block d-md-none button-area container">
    <div class="row g-2 mt-1 justify-content-end">

      <!-- スマホ：ボタン変換の下に横並び -->
      <div class="col-12 d-md-none">
        <div class="row g-2 mt-1">
          <div class="col-6">
            <%= button_tag type: "submit", name: "retry",
              class: "btn btn-outline-secondary w-100 py-2 fs-6" do %>
              <i class="bi bi-arrow-clockwise"></i> 再試行
            <% end %>
          </div>
          <div class="col-6">
            <button type="button" id="clear-btn"
              class="btn btn-outline-secondary border border-dark w-100 py-2 fs-6">
              クリア
            </button>
          </div>
        </div>
      </div>
      <!-- スマホ用ボタン ラスト -->
      <!-- 変換（常に中央） -->
      <div class="col-12 col-md-6 text-center">
        <%= submit_tag "変換", class: "btn btn-light border border-dark w-100 py-3 fs-5" %>
      </div>
      <!--　変換ラスト -->


  </div>
  <textarea name="base_prompt" class="form-control border border-dark mt-3" rows="5" placeholder="入力してください"><%= @input_text %></textarea>
  <!-- スマホ用 入力出エリアラスト -->
</div>

<% end %>
